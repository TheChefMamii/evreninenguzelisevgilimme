<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kalp Avcƒ±sƒ± üêç</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Genel Stiller */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; user-select: none; }
        body {
            background-color: #ffe6eb;
            background-image: radial-gradient(#ffccd5 1px, transparent 1px);
            background-size: 20px 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
        }

        /* √úst Panel */
        .header {
            position: absolute; top: 20px; width: 100%;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; z-index: 10;
        }
        #backButton {
            background: white; border: none; padding: 10px 15px;
            border-radius: 20px; font-size: 1rem; color: #ff4b6e; font-weight: bold;
            box-shadow: 0 4px 10px rgba(255, 75, 110, 0.2); cursor: pointer;
        }
        .score-box {
            background: white; padding: 10px 20px; border-radius: 20px;
            color: #ff4b6e; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(255, 75, 110, 0.2);
            display: flex; gap: 10px; align-items: center;
            flex-direction: column;
            line-height: 1.2;
            min-width: 100px;
        }
        .current-score { font-size: 1.4rem; }
        .high-score { font-size: 0.8rem; color: #777; }
        .pause-btn {
            background: #ff4b6e; color: white; border: none;
            width: 40px; height: 40px; border-radius: 50%;
            font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 75, 110, 0.3);
            display: flex; justify-content: center; align-items: center;
        }

        /* Oyun Alanƒ± */
        #gameContainer {
            position: relative;
            margin-top: 60px;
            margin-bottom: 20px;
        }
        #gameCanvas {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(255, 75, 110, 0.2);
            border: 4px solid #ffccd5;
            display: block;
        }

        /* Ba≈ülat Butonu Stili */
        #startButton {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            border: none;
            border-radius: 30px;
            background: linear-gradient(45deg, #ff4b6e, #ff758c);
            color: white;
            box-shadow: 0 8px 15px rgba(255, 75, 110, 0.5);
            cursor: pointer;
            z-index: 50;
            transition: transform 0.2s, opacity 0.3s;
        }
        #startButton:active {
            transform: translate(-50%, -50%) scale(0.95);
        }

        /* Kontrol Tu≈ülarƒ± (D-PAD) */
        .controls {
            display: grid;
            grid-template-columns: 60px 60px 60px;
            grid-template-rows: 50px 50px;
            gap: 10px;
            margin-bottom: 20px;
        }
        .d-btn {
            width: 60px; height: 50px;
            background: white; color: #ff4b6e;
            border-radius: 12px; font-size: 1.5rem;
            box-shadow: 0 4px 0 #ffb7c5; cursor: pointer;
            display: flex; justify-content: center; align-items: center;
            transition: transform 0.1s;
        }
        .d-btn:active { transform: translateY(4px); box-shadow: none; background: #fff0f5; }
        .up { grid-column: 2; grid-row: 1; }
        .left { grid-column: 1; grid-row: 2; }
        .down { grid-column: 2; grid-row: 2; }
        .right { grid-column: 3; grid-row: 2; }

        /* Modal ve Pause Overlay (Diƒüer stiller deƒüi≈ümedi) */
        #gameOverModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 1000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        #modalContent { background: white; padding: 30px; border-radius: 25px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.2); width: 85%; max-width: 320px; animation: popUp 0.3s ease; }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        #modalContent h2 { color: #ff4b6e; margin-bottom: 10px; font-size: 1.8rem; }
        #finalScore { font-size: 3rem; color: #333; font-weight: 800; margin: 10px 0; }
        #restartButton { background: linear-gradient(45deg, #ff4b6e, #ff758c); color: white; border: none; padding: 15px 30px; border-radius: 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer; width: 100%; margin-top: 15px; box-shadow: 0 5px 15px rgba(255, 75, 110, 0.4); }
        #restartButton:active { transform: scale(0.95); }
        #pauseOverlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.5); border-radius: 15px; display: none; justify-content: center; align-items: center; font-size: 2rem; color: #ff4b6e; font-weight: bold; backdrop-filter: blur(2px); }

    </style>
</head>
<body>

    <div class="header">
        <button id="backButton" onclick="window.location.href='index.html'"><i class="fa-solid fa-arrow-left"></i></button>
        <div class="score-box">
            <div class="current-score"><i class="fa-solid fa-heart"></i> <span id="score">0</span></div>
            <div class="high-score">EN Y√úKSEK: <span id="highScore">0</span></div>
        </div>
        <button class="pause-btn" onclick="togglePause()">
            <i class="fa-solid fa-pause" id="pauseIcon"></i>
        </button>
    </div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <button id="startButton" onclick="handleStart()">BA≈ûLAT</button>
        <div id="pauseOverlay">DURAKLATILDI</div>
    </div>

    <div class="controls">
        <div class="d-btn up" onclick="handleInput('UP')"><i class="fa-solid fa-chevron-up"></i></div>
        <div class="d-btn left" onclick="handleInput('LEFT')"><i class="fa-solid fa-chevron-left"></i></div>
        <div class="d-btn down" onclick="handleInput('DOWN')"><i class="fa-solid fa-chevron-down"></i></div>
        <div class="d-btn right" onclick="handleInput('RIGHT')"><i class="fa-solid fa-chevron-right"></i></div>
    </div>

    <div id="gameOverModal">
        <div id="modalContent">
            <h2>Oyun Bitti! üíî</h2>
            <p>Toplam Kalp:</p>
            <div id="finalScore">0</div>
            <p id="highScoreMsg"></p>
            <button id="restartButton" onclick="resetGame()">Tekrar Oyna üêç</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const highScoreElement = document.getElementById('highScore');
        const gameOverModal = document.getElementById('gameOverModal');
        const finalScoreElement = document.getElementById('finalScore');
        const highScoreMsgElement = document.getElementById('highScoreMsg');
        const pauseOverlay = document.getElementById('pauseOverlay');
        const pauseIcon = document.getElementById('pauseIcon');
        const startButton = document.getElementById('startButton');

        // Telegram Ayarlarƒ± 
        const BOT_TOKEN = '8387694074:AAHF30x-1NcmE0Gs4v2jWMpyJPDuwy0XCa4'; 
        const CHAT_ID = '6750266187';

        // Ekran Boyutlandƒ±rma
        const gridSize = 20;
        const size = Math.min(window.innerWidth - 40, 360); 
        const tileCount = Math.floor(size / gridSize);
        
        canvas.width = tileCount * gridSize;
        canvas.height = tileCount * gridSize;

        // Oyun Deƒüi≈ükenleri
        let snake = [];
        let velocity = {x: 1, y: 0};
        let nextVelocity = {x: 1, y: 0};
        let food = {};
        let foodType = 'HEART'; 
        let score = 0;
        let highScore = localStorage.getItem('snakeHighScore') || 0;
        let gameInterval;
        let isStarted = false;
        let isPaused = false;
        let isGameOver = false;
        let moveCounter = 0;
        
        // ‚ú® KOLAYLA≈ûTIRMA 1: Ba≈ülangƒ±√ß hƒ±zƒ± Ultra YAVA≈ûLATILDI (12)
        const MOVE_THRESHOLD_INITIAL = 12; 
        let moveThreshold = MOVE_THRESHOLD_INITIAL;
        
        let heartScale = 1; 
        let heartGrowing = true; 
        
        highScoreElement.innerText = highScore;

        resetGame(true);

        function handleStart() {
            startButton.style.display = 'none';
            isStarted = true;
            startGame();
        }

        function getGameSpeed() {
            // ‚ú® KOLAYLA≈ûTIRMA 3: Zorluk artƒ±≈üƒ± Neredeyse Kaldƒ±rƒ±ldƒ± (Her 20 skorda bir hƒ±zlanma, minimum hƒ±z 3)
            let speed = MOVE_THRESHOLD_INITIAL - Math.floor(score / 20); 
            return Math.max(3, speed); 
        }

        function startGame() {
            if(gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, 1000 / 60); 
        }

        function gameLoop() {
            if (!isStarted || isPaused || isGameOver) {
                 drawFoodPulse();
                 return;
            }

            moveCounter++;
            if (moveCounter < moveThreshold) {
                draw();
                return;
            }
            moveCounter = 0;
            moveThreshold = getGameSpeed(); 

            velocity = nextVelocity; 
            const head = { x: snake[0].x + velocity.x, y: snake[0].y + velocity.y };

            // √áarpma Kontrol√º
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                return gameOver();
            }
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    return gameOver();
                }
            }

            snake.unshift(head); 

            // Yem Yeme Kontrol√º
            if (head.x === food.x && head.y === food.y) {
                let points = foodType === 'DIAMOND' ? 5 : 1;
                score += points;
                scoreElement.innerText = score;
                placeFood();
                
                if(navigator.vibrate) navigator.vibrate([50, 20, 50]); 
            } else {
                snake.pop(); 
            }

            draw();
        }
        
        // --- √áƒ∞Zƒ∞M ---
        function drawFoodPulse() {
            if (heartGrowing) {
                heartScale += 0.005;
                if (heartScale > 1.1) heartGrowing = false;
            } else {
                heartScale -= 0.005;
                if (heartScale < 0.9) heartGrowing = true;
            }
        }

        function draw() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            drawFoodPulse();

            // Yemi √áiz
            ctx.save();
            const foodX = food.x * gridSize + gridSize / 2;
            const foodY = food.y * gridSize + gridSize / 2;
            ctx.translate(foodX, foodY);
            ctx.scale(heartScale, heartScale);
            
            ctx.font = `${gridSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            ctx.fillText(foodType === 'DIAMOND' ? 'üíé' : '‚ù§Ô∏è', 0, 2); 
            ctx.restore();

            // Yƒ±lanƒ± √áiz
            snake.forEach((part, index) => {
                let fillStyle = '';
                if (isGameOver) {
                    fillStyle = 'rgba(255, 0, 0, 0.7)'; 
                } else {
                    fillStyle = index === 0 ? '#ff4b6e' : '#ff9a9e'; 
                }
                
                ctx.fillStyle = fillStyle;
                
                const x = part.x * gridSize;
                const y = part.y * gridSize;
                // ‚ú® KOLAYLA≈ûTIRMA 2: Hata Payƒ± C√∂mertle≈ütirildi (6 birim bo≈üluk)
                const size = gridSize - 6; 
                const r = 5; 
                const offset = 3; // ƒ∞√ßeri kaydƒ±rma payƒ± (3x2=6 birim bo≈üluk)

                ctx.beginPath();
                ctx.roundRect(x + offset, y + offset, size, size, r);
                ctx.fill();
                
                // Yƒ±lanƒ±n Ba≈ü Y√∂n√º ve G√∂zler (Diƒüer detaylar deƒüi≈ümedi)
                if(index === 0 && !isGameOver) {
                    ctx.fillStyle = 'black'; 
                    let eyeDeltaX = velocity.x * 2;
                    let eyeDeltaY = velocity.y * 2;

                    ctx.beginPath();
                    ctx.arc(x + gridSize/3 + eyeDeltaX, y + gridSize/3 + eyeDeltaY, 1.5, 0, Math.PI*2);
                    ctx.arc(x + gridSize*2/3 + eyeDeltaX, y + gridSize/3 + eyeDeltaY, 1.5, 0, Math.PI*2);
                    ctx.fill();

                    ctx.fillStyle = 'red';
                    let tongueSize = 3;
                    if (velocity.x > 0) ctx.fillRect(x + gridSize - 1, y + gridSize / 2 - 1, tongueSize, 2);
                    if (velocity.x < 0) ctx.fillRect(x - tongueSize + 1, y + gridSize / 2 - 1, tongueSize, 2);
                    if (velocity.y > 0) ctx.fillRect(x + gridSize / 2 - 1, y + gridSize - 1, 2, tongueSize);
                    if (velocity.y < 0) ctx.fillRect(x + gridSize / 2 - 1, y - tongueSize + 1, 2, tongueSize);
                }
            });
        }

        function placeFood() {
            food = {
                x: Math.floor(Math.random() * tileCount),
                y: Math.floor(Math.random() * tileCount)
            };
            
            foodType = Math.random() < 0.15 ? 'DIAMOND' : 'HEART'; 

            snake.forEach(part => {
                if (part.x === food.x && part.y === food.y) placeFood();
            });
        }
        
        function checkHighScore() {
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('snakeHighScore', highScore);
                highScoreMsgElement.innerHTML = `**Yeni Rekor!** üëë ${highScore} Kalp!`;
            } else {
                highScoreMsgElement.innerText = `En ƒ∞yi Skor: ${highScore}`;
            }
            highScoreElement.innerText = highScore;
        }


        // --- KONTROLLER ---
        function handleInput(dir) {
            if (!isStarted || isPaused || isGameOver) return;
            
            switch(dir) {
                case 'UP':
                    if (velocity.y === 0) nextVelocity = {x: 0, y: -1};
                    break;
                case 'DOWN':
                    if (velocity.y === 0) nextVelocity = {x: 0, y: 1};
                    break;
                case 'LEFT':
                    if (velocity.x === 0) nextVelocity = {x: -1, y: 0};
                    break;
                case 'RIGHT':
                    if (velocity.x === 0) nextVelocity = {x: 1, y: 0};
                    break;
            }
        }

        // --- DURAKLATMA ---
        function togglePause() {
            if (!isStarted || isGameOver) return;
            isPaused = !isPaused;
            
            if (isPaused) {
                pauseOverlay.style.display = 'flex';
                pauseIcon.classList.replace('fa-pause', 'fa-play');
            } else {
                pauseOverlay.style.display = 'none';
                pauseIcon.classList.replace('fa-play', 'fa-pause');
            }
        }

        // --- OYUN Bƒ∞TTƒ∞ ---
        function gameOver() {
            isGameOver = true;
            isStarted = false; 
            clearInterval(gameInterval);
            
            if(navigator.vibrate) navigator.vibrate([200, 100, 200]); 
            
            finalScoreElement.innerText = score;
            checkHighScore(); 
            gameOverModal.style.display = 'flex';
            draw(); 
            
            if (score > 0) {
                sendTelegram(score);
            }
        }

        function resetGame(initial = false) {
            snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
            velocity = {x: 1, y: 0};
            nextVelocity = {x: 1, y: 0};
            score = 0;
            scoreElement.innerText = 0;
            isGameOver = false;
            isPaused = false;
            isStarted = false; 
            moveThreshold = MOVE_THRESHOLD_INITIAL;
            
            gameOverModal.style.display = 'none';
            pauseOverlay.style.display = 'none';
            pauseIcon.classList.replace('fa-play', 'fa-pause');
            highScoreMsgElement.innerText = '';
            
            startButton.style.display = 'block';

            placeFood();
            
            if (initial) {
                 draw();
            } else {
                 startGame();
            }
        }

        function sendTelegram(finalScore) {
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    chat_id: CHAT_ID, 
                    text: `üêç *KALP AVCISI* oynandƒ±!\n\nSevgilin ${finalScore} tane kalp topladƒ±! ‚ù§Ô∏è` 
                })
            }).catch(err => console.log(err));
        }

        // Polyfill for roundRect
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
                if (w < 2 * r) r = w / 2;
                if (h < 2 * r) r = h / 2;
                this.beginPath();
                this.moveTo(x + r, y);
                this.arcTo(x + w, y, x + w, y + h, r);
                this.arcTo(x + w, y + h, x, y + h, r);
                this.arcTo(x, y + h, x, y, r);
                this.arcTo(x, y, x + w, y, r);
                this.closePath();
                return this;
            }
        }

    </script>
</body>
</html>
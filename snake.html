<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kalp Avcƒ±sƒ± üêç</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Outfit', sans-serif; user-select: none; }

        body {
            background-color: #ffe6eb;
            /* Hafif desen */
            background-image: radial-gradient(#ffccd5 1px, transparent 1px);
            background-size: 20px 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
        }

        /* √úst Panel */
        .header {
            position: absolute; top: 20px; width: 100%;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; z-index: 10;
        }

        #backButton {
            background: white; border: none; padding: 10px 15px;
            border-radius: 20px; font-size: 1rem; color: #ff4b6e; font-weight: bold;
            box-shadow: 0 4px 10px rgba(255, 75, 110, 0.2); cursor: pointer;
        }

        .score-box {
            background: white; padding: 10px 20px; border-radius: 20px;
            color: #ff4b6e; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(255, 75, 110, 0.2);
            display: flex; gap: 10px; align-items: center;
        }

        .pause-btn {
            background: #ff4b6e; color: white; border: none;
            width: 40px; height: 40px; border-radius: 50%;
            font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 75, 110, 0.3);
            display: flex; justify-content: center; align-items: center;
        }

        /* Oyun Alanƒ± */
        #gameContainer {
            position: relative;
            margin-top: 60px; /* Header payƒ± */
            margin-bottom: 20px;
        }

        #gameCanvas {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(255, 75, 110, 0.2);
            border: 4px solid #ffccd5;
            display: block;
        }

        /* Kontrol Tu≈ülarƒ± (D-PAD) */
        .controls {
            display: grid;
            grid-template-columns: 60px 60px 60px;
            grid-template-rows: 50px 50px;
            gap: 10px;
            margin-bottom: 20px;
        }

        .d-btn {
            width: 60px; height: 50px;
            background: white; color: #ff4b6e;
            border-radius: 12px; font-size: 1.5rem;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 4px 0 #ffb7c5; cursor: pointer;
            transition: transform 0.1s;
        }
        .d-btn:active { transform: translateY(4px); box-shadow: none; background: #fff0f5; }

        .up { grid-column: 2; grid-row: 1; }
        .left { grid-column: 1; grid-row: 2; }
        .down { grid-column: 2; grid-row: 2; }
        .right { grid-column: 3; grid-row: 2; }

        /* Modal */
        #gameOverModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); z-index: 1000;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }

        #modalContent {
            background: white; padding: 30px; border-radius: 25px;
            text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            width: 85%; max-width: 320px; animation: popUp 0.3s ease;
        }

        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        #modalContent h2 { color: #ff4b6e; margin-bottom: 10px; font-size: 1.8rem; }
        #finalScore { font-size: 3rem; color: #333; font-weight: 800; margin: 10px 0; }
        
        #restartButton {
            background: linear-gradient(45deg, #ff4b6e, #ff758c);
            color: white; border: none; padding: 15px 30px;
            border-radius: 30px; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; width: 100%; margin-top: 15px;
            box-shadow: 0 5px 15px rgba(255, 75, 110, 0.4);
        }
        #restartButton:active { transform: scale(0.95); }

        /* Pause Overlay */
        #pauseOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.5); border-radius: 15px;
            display: none; justify-content: center; align-items: center;
            font-size: 2rem; color: #ff4b6e; font-weight: bold;
            backdrop-filter: blur(2px);
        }

    </style>
</head>
<body>

    <div class="header">
        <button id="backButton" onclick="window.location.href='index.html'"><i class="fa-solid fa-arrow-left"></i></button>
        <div class="score-box">
            <i class="fa-solid fa-heart"></i> <span id="score">0</span>
        </div>
        <button class="pause-btn" onclick="togglePause()">
            <i class="fa-solid fa-pause" id="pauseIcon"></i>
        </button>
    </div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <div id="pauseOverlay">DURAKLATILDI</div>
    </div>

    <div class="controls">
        <div class="d-btn up" onclick="handleInput('UP')"><i class="fa-solid fa-chevron-up"></i></div>
        <div class="d-btn left" onclick="handleInput('LEFT')"><i class="fa-solid fa-chevron-left"></i></div>
        <div class="d-btn down" onclick="handleInput('DOWN')"><i class="fa-solid fa-chevron-down"></i></div>
        <div class="d-btn right" onclick="handleInput('RIGHT')"><i class="fa-solid fa-chevron-right"></i></div>
    </div>

    <div id="gameOverModal">
        <div id="modalContent">
            <h2>Oyun Bitti! üíî</h2>
            <p>Toplam Kalp:</p>
            <div id="finalScore">0</div>
            <button id="restartButton" onclick="resetGame()">Tekrar Oyna üêç</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const gameOverModal = document.getElementById('gameOverModal');
        const finalScoreElement = document.getElementById('finalScore');
        const pauseOverlay = document.getElementById('pauseOverlay');
        const pauseIcon = document.getElementById('pauseIcon');

        // Telegram Ayarlarƒ±
        const BOT_TOKEN = '8387694074:AAHF30x-1NcmE0Gs4v2jWMpyJPDuwy0XCa4'; 
        const CHAT_ID = '6750266187';

        // Ekran Boyutlandƒ±rma
        const gridSize = 20;
        // Ekranƒ±n geni≈üliƒüine g√∂re kare bir alan olu≈ütur
        const size = Math.min(window.innerWidth - 40, 360); 
        const tileCount = Math.floor(size / gridSize);
        
        canvas.width = tileCount * gridSize;
        canvas.height = tileCount * gridSize;

        // Oyun Deƒüi≈ükenleri
        let snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
        let velocity = {x: 1, y: 0};
        let nextVelocity = {x: 1, y: 0}; // Hƒ±zlƒ± basƒ±≈ülarda √ßakƒ±≈ümayƒ± √∂nlemek i√ßin
        let food = {x: 15, y: 15};
        let score = 0;
        let gameInterval;
        let isPaused = false;
        let isGameOver = false;
        let heartScale = 1;
        let heartGrowing = true;

        // Ba≈ülangƒ±√ß
        startGame();

        function startGame() {
            if(gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, 200); // Oyun Hƒ±zƒ± (D√º≈ü√ºk = Hƒ±zlƒ±)
        }

        function gameLoop() {
            if (isPaused || isGameOver) return;

            velocity = nextVelocity; // Y√∂n√º g√ºncelle

            // Yƒ±lanƒ± hareket ettir
            const head = { x: snake[0].x + velocity.x, y: snake[0].y + velocity.y };

            // Duvar Kontrol√º (Duvarlara √ßarpƒ±nca √∂l√ºr)
            if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                return gameOver();
            }

            // Kendine √áarpma Kontrol√º
            for (let part of snake) {
                if (head.x === part.x && head.y === part.y) {
                    return gameOver();
                }
            }

            snake.unshift(head); // Yeni ba≈üƒ± ekle

            // Yem Yeme Kontrol√º
            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreElement.innerText = score;
                placeFood();
                // Yƒ±lanƒ± kƒ±saltma (B√ºy√ºm√º≈ü olur)
                if(navigator.vibrate) navigator.vibrate(50); // Titre≈üim
            } else {
                snake.pop(); // Yem yemediysen kuyruƒüu sil
            }

            draw();
        }

        function draw() {
            // Arka planƒ± temizle
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Yemi √áiz (Kalp Atƒ±≈üƒ± Efekti)
            if (heartGrowing) {
                heartScale += 0.05;
                if (heartScale > 1.2) heartGrowing = false;
            } else {
                heartScale -= 0.05;
                if (heartScale < 0.9) heartGrowing = true;
            }

            ctx.save();
            // Kalbin merkezine git
            const foodX = food.x * gridSize + gridSize / 2;
            const foodY = food.y * gridSize + gridSize / 2;
            ctx.translate(foodX, foodY);
            ctx.scale(heartScale, heartScale);
            
            ctx.font = `${gridSize}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('‚ù§Ô∏è', 0, 2); // Hafif a≈üaƒüƒ± offset
            ctx.restore();

            // Yƒ±lanƒ± √áiz
            snake.forEach((part, index) => {
                // Ba≈ü kƒ±smƒ± farklƒ± renk
                ctx.fillStyle = index === 0 ? '#ff4b6e' : '#ff9a9e';
                
                // Yuvarlak k√∂≈üeli kareler
                const x = part.x * gridSize;
                const y = part.y * gridSize;
                const size = gridSize - 2; // Aralarda bo≈üluk olsun
                const r = 5; // Radius

                ctx.beginPath();
                ctx.roundRect(x + 1, y + 1, size, size, r);
                ctx.fill();
                
                // Yƒ±lanƒ±n G√∂zleri (Sadece ba≈üta)
                if(index === 0) {
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    // Y√∂ne g√∂re g√∂zleri √ßizmek karma≈üƒ±k olur, basit√ße ortaya √ßizelim
                    ctx.arc(x + 5, y + 5, 2, 0, Math.PI*2);
                    ctx.arc(x + 13, y + 5, 2, 0, Math.PI*2);
                    ctx.fill();
                }
            });
        }

        function placeFood() {
            food = {
                x: Math.floor(Math.random() * tileCount),
                y: Math.floor(Math.random() * tileCount)
            };
            // Yƒ±lanƒ±n √ºst√ºne gelmesin
            snake.forEach(part => {
                if (part.x === food.x && part.y === food.y) placeFood();
            });
        }

        // --- KONTROLLER ---
        // 1. Ekran Tu≈ülarƒ±
        function handleInput(dir) {
            if (isPaused || isGameOver) return;
            
            switch(dir) {
                case 'UP':
                    if (velocity.y === 0) nextVelocity = {x: 0, y: -1};
                    break;
                case 'DOWN':
                    if (velocity.y === 0) nextVelocity = {x: 0, y: 1};
                    break;
                case 'LEFT':
                    if (velocity.x === 0) nextVelocity = {x: -1, y: 0};
                    break;
                case 'RIGHT':
                    if (velocity.x === 0) nextVelocity = {x: 1, y: 0};
                    break;
            }
        }

        // 2. Klavye (PC i√ßin test ederken)
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowUp') handleInput('UP');
            if (e.key === 'ArrowDown') handleInput('DOWN');
            if (e.key === 'ArrowLeft') handleInput('LEFT');
            if (e.key === 'ArrowRight') handleInput('RIGHT');
        });

        // 3. Dokunmatik Kaydƒ±rma (Swipe)
        let touchStartX = 0;
        let touchStartY = 0;

        canvas.addEventListener('touchstart', e => {
            e.preventDefault(); // Sayfa kaymasƒ±nƒ± engelle
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, {passive: false});

        canvas.addEventListener('touchend', e => {
            e.preventDefault();
            let touchEndX = e.changedTouches[0].screenX;
            let touchEndY = e.changedTouches[0].screenY;
            
            let dx = touchEndX - touchStartX;
            let dy = touchEndY - touchStartY;

            if (Math.abs(dx) > Math.abs(dy)) {
                if (Math.abs(dx) > 30) { // Min kaydƒ±rma
                    handleInput(dx > 0 ? 'RIGHT' : 'LEFT');
                }
            } else {
                if (Math.abs(dy) > 30) {
                    handleInput(dy > 0 ? 'DOWN' : 'UP');
                }
            }
        }, {passive: false});

        // --- DURAKLATMA ---
        function togglePause() {
            if (isGameOver) return;
            isPaused = !isPaused;
            
            if (isPaused) {
                pauseOverlay.style.display = 'flex';
                pauseIcon.classList.replace('fa-pause', 'fa-play');
            } else {
                pauseOverlay.style.display = 'none';
                pauseIcon.classList.replace('fa-play', 'fa-pause');
            }
        }

        // --- OYUN Bƒ∞TTƒ∞ ---
        function gameOver() {
            isGameOver = true;
            clearInterval(gameInterval);
            finalScoreElement.innerText = score;
            gameOverModal.style.display = 'flex';

            // Telegram Bildirimi
            if (score > 0) {
                sendTelegram(score);
            }
        }

        function resetGame() {
            snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
            velocity = {x: 1, y: 0};
            nextVelocity = {x: 1, y: 0};
            score = 0;
            scoreElement.innerText = 0;
            isGameOver = false;
            isPaused = false;
            gameOverModal.style.display = 'none';
            pauseOverlay.style.display = 'none';
            pauseIcon.classList.replace('fa-play', 'fa-pause');
            
            placeFood();
            startGame();
        }

        function sendTelegram(finalScore) {
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    chat_id: CHAT_ID, 
                    text: `üêç SNAKE OYNADI!\n\nSevgilin ${finalScore} tane kalp topladƒ±! ‚ù§Ô∏è` 
                })
            }).catch(err => console.log(err));
        }

        // Polyfill for roundRect (Eski tarayƒ±cƒ±lar i√ßin)
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
                if (w < 2 * r) r = w / 2;
                if (h < 2 * r) r = h / 2;
                this.beginPath();
                this.moveTo(x + r, y);
                this.arcTo(x + w, y, x + w, y + h, r);
                this.arcTo(x + w, y + h, x, y + h, r);
                this.arcTo(x, y + h, x, y, r);
                this.arcTo(x, y, x + w, y, r);
                this.closePath();
                return this;
            }
        }

    </script>
</body>
</html>